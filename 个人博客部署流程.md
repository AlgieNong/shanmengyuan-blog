# 博客系统从 0 到 1 部署流程（Vue 3 + Vite + Tailwind CSS + Decap CMS + GitHub Pages + GitHub Actions）

本流程文档将指导你从零开始搭建整套博客系统，涵盖环境准备、项目初始化、样式系统、内容管理、构建与部署、CI/CD，以及日常发布维护的完整步骤。严格按步骤执行即可完成上线。

---

## 1. 概览

- 前端框架: Vue 3 + Vite
- 样式方案: Tailwind CSS
- 内容管理: Decap CMS（Git-based CMS）
- 部署平台: GitHub Pages
- CI/CD: GitHub Actions
- 版本控制: Git + GitHub

系统架构流程：

1) 本地开发（Vite + Tailwind） → 2) 内容存储（Markdown + 媒体） → 3) Decap CMS 可视化编辑（本地/在线） → 4) 推送到 GitHub → 5) Actions 构建 → 6) 部署到 GitHub Pages → 7) 用户访问网站

---

## 2. 前置条件与工具

- Node.js: 建议 18.x LTS 或 20.x
- 包管理器: 任一（pnpm / npm / yarn），文档以 pnpm 为例
- Git 与 GitHub 账号
- macOS/Linux/Windows（Windows 建议 WSL2）

验证环境：

```bash
node -v
corepack enable
pnpm -v
git --version
```

---

## 3. 创建 GitHub 仓库与本地初始化

1) 在 GitHub 新建仓库（推荐名：`<USERNAME>/blog`）。
2) 本地克隆：

```bash
git clone https://github.com/<USERNAME>/blog.git
cd blog
```

3) 设置 Git 用户信息（仅针对当前仓库）：

```bash
git config user.name "Your Name"
git config user.email "you@example.com"
```

---

## 4. 使用 Vite 初始化 Vue 3 项目

1) 在仓库根目录执行：

```bash
pnpm create vite@latest .
# 交互选项：
# Framework: Vue
# Variant: TypeScript（推荐）
```

2) 安装依赖：

```bash
pnpm install
```

3) 启动开发服务器验证：

```bash
pnpm dev
```

浏览器打开 http://localhost:5173 确认项目正常。

推荐目录结构（创建后续目录时参考）：

```
src/
├─ assets/
├─ components/
├─ layouts/
├─ pages/
├─ router/
├─ stores/
├─ utils/
└─ main.ts
```

---

## 5. 集成 Tailwind CSS

1) 安装 Tailwind 及相关依赖：

```bash
pnpm add -D tailwindcss postcss autoprefixer
pnpm exec tailwindcss init -p
```

将生成 `tailwind.config.cjs` 与 `postcss.config.cjs`。

2) 配置 `tailwind.config.cjs`（确保扫描 Vue 文件与 CMS 管理页）：

```javascript
// tailwind.config.cjs
module.exports = {
  content: [
    './index.html',
    './src/**/*.{vue,ts,tsx,js,jsx}',
    './public/admin/**/*.html',
  ],
  theme: {
    extend: {
      colors: {
        brand: {
          DEFAULT: '#3b82f6',
          dark: '#1d4ed8',
        },
      },
    },
  },
  plugins: [
    require('@tailwindcss/typography'),
    require('@tailwindcss/forms'),
  ],
}
```

3) 创建样式入口 `src/assets/main.css`：

```css
@tailwind base;
@tailwind components;
@tailwind utilities;
```

4) 在 `src/main.ts` 引入样式：

```ts
import './assets/main.css'
```

5) 启动开发验证样式是否生效：

```bash
pnpm dev
```

---

## 6. 内容结构与 Markdown 约定

1) 在项目根目录创建内容目录：

```
content/
└─ posts/
```

2) 新建示例文章 `content/posts/hello-world.md`：

```markdown
---
title: "Hello World"
date: 2025-01-01
tags: [intro]
excerpt: "我的第一篇博客"
heroImage: "/images/hello.jpg"
draft: false
---

这里是正文内容，支持 Markdown 语法。
```

Front Matter 字段说明：
- `title`：文章标题
- `date`：发布时间（ISO 日期）
- `tags`：标签数组
- `excerpt`：摘要
- `heroImage`：头图路径（会存储在指定媒体目录）
- `draft`：是否草稿（true 不展示，false 展示）

---

## 7. 集成 Decap CMS（本地编辑与可选在线编辑）

Decap CMS 是 Git 驱动的 CMS。我们使用两种模式：
- 本地编辑（推荐起步）：使用 `local_backend` 与代理服务在本地可视化编辑，提交直接写入仓库文件。
- 在线编辑（可选进阶）：在 GitHub Pages 上访问 `/admin/`，需要配置 GitHub OAuth 回调服务（额外部署一个 OAuth Provider）。本流程提供可选方案链接与步骤要点。

### 7.1 添加 CMS 管理页面

1) 创建目录与文件：

```
public/admin/index.html
public/admin/config.yml
```

2) `public/admin/index.html` 内容：

```html
<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Content Manager</title>
    <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
  </head>
  <body>
    <!-- Decap CMS Mount Point -->
  </body>
</html>
```

3) `public/admin/config.yml`（本地编辑默认配置）：

```yaml
local_backend: true
backend:
  name: git-gateway
  branch: main
media_folder: "public/images"
public_folder: "/images"
collections:
  - name: "posts"
    label: "Posts"
    label_singular: "Post"
    folder: "content/posts"
    create: true
    slug: "{{year}}-{{month}}-{{day}}-{{slug}}"
    fields:
      - { label: "Title", name: "title", widget: "string" }
      - { label: "Publish Date", name: "date", widget: "datetime" }
      - { label: "Tags", name: "tags", widget: "list", default: [] }
      - { label: "Excerpt", name: "excerpt", widget: "text" }
      - {
          label: "Hero Image",
          name: "heroImage",
          widget: "image",
          allow_multiple: false
        }
      - { label: "Draft", name: "draft", widget: "boolean", default: false }
      - { label: "Body", name: "body", widget: "markdown" }
```

说明：
- `local_backend: true` 便于本地调试（无需 OAuth），联动代理服务。
- `media_folder` 存储上传媒体的物理路径；`public_folder` 是线上访问路径。
- `backend` 在线模式时会调整为 `github`，详见“在线编辑（可选）”。

### 7.2 本地运行 CMS 代理并编辑

本地编辑需要一个代理服务来模拟身份：

```bash
pnpm dlx decap-server
# 或（等价工具名）
# pnpm dlx netlify-cms-proxy-server
```

然后在另一个终端运行开发服务器：

```bash
pnpm dev
```

访问 http://localhost:5173/admin 打开 CMS，创建/编辑文章后会直接写入本地文件（`content/posts` 与 `public/images`）。

提交变更：

```bash
git add .
git commit -m "content: add first post via decap"
```

### 7.3 在线编辑（可选进阶）

若希望在生产环境的 `/admin/` 直接在线编辑，需要 GitHub OAuth Provider 服务：

1) 在 `public/admin/config.yml` 切换 backend：

```yaml
backend:
  name: github
  repo: <USERNAME>/blog
  branch: main
```

2) 部署 OAuth Provider（任一方案）：
- 使用 `netlify-cms-oauth-provider`（Node 服务）部署到 Vercel/Render/自建服务器。
- 或参考 Decap 官方文档的 GitHub 身份验证章节。

3) 在 `config.yml` 中添加 `base_url`、`auth_endpoint` 等字段指向你的 OAuth 服务。

注：在线编辑涉及第三方服务配置与回调安全，建议项目成熟后再启用。起步阶段使用本地编辑 + Git 提交更稳定可控。

---

## 8. 在 Vue 中加载 Markdown 内容（基础示例）

最小可行方案：构建时将 `content/posts` 作为静态源，运行时通过 Vite 的 `import.meta.glob` 读取并渲染（或选择更成熟的内容插件）。这里给出基础思路：

1) 安装 Markdown 解析器（任选）：

```bash
pnpm add marked
```

2) 在页面组件中加载所有文章元数据（示例）：

```ts
// src/utils/posts.ts
export async function loadPosts() {
  const modules = import.meta.glob('/content/posts/*.md', { as: 'raw', eager: true });
  // 解析 Front Matter 可使用 gray-matter
}
```

实际项目可引入 `gray-matter` 解析 Front Matter，并在页面中按日期/标签排序展示。你也可以选用 Vite 插件（如 `vite-plugin-markdown`、`vite-plugin-vue-markdown`）或切换为基于内容的框架（如 VitePress/Nuxt Content），此处不做强绑定。

---

## 9. GitHub Pages 部署配置

GitHub Pages 有两种常见部署方式：
- 部署到用户/组织页（`<USERNAME>.github.io`），`base: '/'`。
- 部署到项目页（`<USERNAME>.github.io/<REPO>`），需要在 Vite 配置中设置 `base: '/<REPO>/'`。

本流程以“项目页”方式为例（仓库名 `blog`）。

### 9.1 配置 Vite `base`

在 `vite.config.ts` 中设置：

```ts
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'

export default defineConfig({
  plugins: [vue()],
  base: '/blog/', // 仓库名，若为用户页请改为 '/'
})
```

### 9.2 在 GitHub 仓库启用 Pages

- 打开仓库 → Settings → Pages
- Source 选择：Deploy from a branch（Actions 会推送到 `gh-pages` 分支）
- Branch 选择：`gh-pages` / root（待首次部署后可见）

---

## 10. GitHub Actions 自动化部署（CI/CD）

我们使用 Actions 在每次推送到 `main` 时自动构建并部署到 `gh-pages` 分支。

1) 新建工作流文件：`.github/workflows/deploy.yml`

```yaml
name: Deploy to GitHub Pages

on:
  push:
    branches: ["main"]
  workflow_dispatch: {}

permissions:
  contents: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'pnpm'

      - name: Setup PNPM
        uses: pnpm/action-setup@v4
        with:
          version: 9

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: Build
        run: pnpm build

      - name: Deploy
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist
          publish_branch: gh-pages
          force_orphan: true
```

2) 在 `package.json` 中确保存在构建脚本：

```json
{
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  }
}
```

3) 推送到 GitHub 触发部署：

```bash
git add .
git commit -m "chore: setup tailwind + decap + actions"
git push origin main
```

4) 首次部署后，回到仓库 Settings → Pages，将 Branch 设置为 `gh-pages`（若未自动设置）。

5) 访问地址：`https://<USERNAME>.github.io/blog/`

---

## 11. 本地开发与内容发布日常流程

- 拉取最新代码：`git pull`
- 运行本地 CMS 代理：`pnpm dlx decap-server`
- 运行开发服务器：`pnpm dev`
- 访问 `http://localhost:5173/admin` 新建/编辑文章
- 完成后提交并推送：

```bash
git add .
git commit -m "post: add <your-title>"
git push origin main
```

- GitHub Actions 自动构建并部署到 Pages；数十秒后生效。

---

## 12. 常见问题与排查

1) 页面 404 或资源路径错误：
- 检查 `vite.config.ts` 的 `base` 是否为 `'/<REPO>/'`。
- 确认 GitHub Pages 选择的是 `gh-pages` 分支。

2) 样式未生效：
- 检查 `tailwind.config.cjs` 的 `content` 路径是否覆盖到 `src/**/*.vue` 与 `index.html`。
- 确认已引入 `src/assets/main.css`。

3) CMS 无法上传图片：
- 检查 `media_folder` 与 `public_folder` 配置，一般为 `public/images` 与 `/images`。
- 确认对 `public/images` 有写入权限（本地）且已提交到仓库（远端）。

4) 在线编辑登录失败：
- 未配置 OAuth Provider 或回调 URL 不正确。建议先使用本地编辑模式。

5) Actions 构建失败：
- 查看 Actions 日志，常见是 Node/Pnpm 版本或锁文件问题。
- 尝试在本地 `pnpm install && pnpm build` 复现实验。

---

## 13. 进阶与优化建议

- 内容插件：使用 `gray-matter` + `marked` 或接入 `vite-plugin-vue-markdown` 提升研发体验。
- SEO：添加 `meta`、Open Graph、Sitemap、RSS（可用 `vite-plugin-pages` + 自定义生成器）。
- UI 与可访问性：利用 `@tailwindcss/typography` 优化文章排版，提供暗色模式。
- 预览草稿：在构建阶段过滤 `draft: true` 的文章，或启用预览环境（分支/PR 预览）。
- 多语言与标签页：建立 `pages/[slug].vue` 动态路由与标签聚合页。

---

## 14. 最终检查清单（Go-Live）

- [ ] 本地能运行 `pnpm dev`，页面与样式正常
- [ ] `http://localhost:5173/admin` 能通过 Decap CMS 新建/编辑文章
- [ ] 有至少一篇文章在 `content/posts/`
- [ ] `vite.config.ts` 正确设置 `base`
- [ ] `.github/workflows/deploy.yml` 存在且本地可 `pnpm build`
- [ ] GitHub Pages 已指向 `gh-pages` 分支
- [ ] 生产地址可访问（示例：`https://<USERNAME>.github.io/blog/`）

---

## 15. 参考链接

- Decap CMS 文档：https://decapcms.org/docs/
- GitHub Pages 文档：
  - 项目页：https://docs.github.com/en/pages/getting-started-with-github-pages/creating-a-github-pages-site
- peaceiris/actions-gh-pages：https://github.com/peaceiris/actions-gh-pages
- Tailwind CSS 文档：https://tailwindcss.com/docs
- Vite 文档：https://vitejs.dev/guide/

---

完成以上步骤后，你将拥有：
- 基于 Vue 3 + Vite 的博客前端
- Tailwind CSS 原子化样式体系
- Decap CMS 本地可视化内容编辑能力
- 使用 GitHub Actions 自动化部署到 GitHub Pages 的 CI/CD 流程

按本文档逐步执行，即可从 0 到 1 完成上线。祝发布顺利！
